<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Temporizador de Treino</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    html, body {
      height: 100%;
    }

    .timer-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
    }

    .title {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 700;
      text-align: center;
      margin: 0;
    }

    .theme-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: clamp(45px, 12vw, 55px);
      height: clamp(45px, 12vw, 55px);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.25rem, 4vw, 1.5rem);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      z-index: 10;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .theme-toggle:active {
      transform: scale(0.95);
    }

    .time-settings {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 500px;
    }

    .time-control {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      min-width: 140px;
    }

    .time-control label {
      font-size: clamp(0.75rem, 2.5vw, 0.875rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .time-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
      justify-content: center;
    }

    .time-btn {
      width: clamp(35px, 10vw, 40px);
      height: clamp(35px, 10vw, 40px);
      border: none;
      border-radius: 0.375rem;
      font-size: clamp(1rem, 3vw, 1.25rem);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .time-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .time-btn:active {
      transform: scale(0.95);
    }

    .time-display {
      font-size: clamp(1.125rem, 4vw, 1.5rem);
      font-weight: 700;
      min-width: clamp(50px, 15vw, 60px);
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.375rem;
    }

    .sphere-container {
      position: relative;
      width: clamp(200px, 60vw, 300px);
      height: clamp(200px, 60vw, 300px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 640px) {
      .timer-wrapper {
        gap: 0.75rem;
        padding: 0.75rem;
      }
      
      .time-settings {
        gap: 0.75rem;
      }
      
      .sphere-container {
        width: clamp(180px, 70vw, 250px);
        height: clamp(180px, 70vw, 250px);
      }
    }

    @media (max-width: 390px) {
      .timer-wrapper {
        gap: 0.5rem;
      }
      
      .sphere-container {
        width: clamp(160px, 75vw, 220px);
        height: clamp(160px, 75vw, 220px);
      }
    }

    .sphere {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sphere::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0) 100%);
      pointer-events: none;
    }

    .sphere.rotating {
      animation: rotate 1s linear infinite;
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    .timer-display {
      font-size: clamp(2.5rem, 10vw, 4rem);
      font-weight: 700;
      margin: 0;
      z-index: 1;
    }

    .phase-label {
      font-size: clamp(1rem, 4vw, 1.5rem);
      font-weight: 600;
      text-transform: uppercase;
      margin: 0.5rem 0 0 0;
      z-index: 1;
    }

    .controls {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 500px;
    }

    .btn {
      padding: clamp(0.75rem, 3vw, 1rem) clamp(1.5rem, 5vw, 2rem);
      font-size: clamp(1rem, 3vw, 1.125rem);
      font-weight: 600;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      flex: 1;
      min-width: 100px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-start {
      background: #10b981;
      color: white;
    }

    .btn-start:hover {
      background: #059669;
    }

    .btn-pause {
      background: #f59e0b;
      color: white;
    }

    .btn-pause:hover {
      background: #d97706;
    }

    .btn-reset {
      background: #ef4444;
      color: white;
    }

    .btn-reset:hover {
      background: #dc2626;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><button class="theme-toggle" id="themeToggle" aria-label="Alternar tema">ðŸŒ™</button>
  <main class="timer-wrapper">
   <h1 class="title" id="title">Temporizador de Treino</h1>
   <div class="time-settings">
    <div class="time-control"><label id="workLabel">Treino</label>
     <div class="time-input-group"><button class="time-btn" id="decreaseWork">-</button>
      <div class="time-display" id="workTimeDisplay">
       40s
      </div><button class="time-btn" id="increaseWork">+</button>
     </div>
    </div>
    <div class="time-control"><label id="restLabel">Descanso</label>
     <div class="time-input-group"><button class="time-btn" id="decreaseRest">-</button>
      <div class="time-display" id="restTimeDisplay">
       20s
      </div><button class="time-btn" id="increaseRest">+</button>
     </div>
    </div>
   </div>
   <div class="sphere-container">
    <div class="sphere" id="sphere">
     <div class="timer-display" id="timer">
      40
     </div>
     <div class="phase-label" id="phase">
      TREINO
     </div>
    </div>
   </div>
   <div class="controls"><button class="btn btn-start" id="startBtn">Iniciar</button> <button class="btn btn-pause" id="pauseBtn" style="display: none;">Pausar</button> <button class="btn btn-reset" id="resetBtn">Reiniciar</button>
   </div>
  </main>
  <script>
    const defaultConfig = {
      background_color: '#1e293b',
      sphere_work_color: '#ef4444',
      sphere_rest_color: '#3b82f6',
      text_color: '#ffffff',
      title_color: '#f8fafc',
      control_bg_color: '#334155',
      font_family: 'Inter',
      font_size: 16,
      title_text: 'Temporizador de Treino',
      work_label: 'TREINO',
      rest_label: 'DESCANSO'
    };

    const lightTheme = {
      background_color: '#f1f5f9',
      sphere_work_color: '#ef4444',
      sphere_rest_color: '#3b82f6',
      text_color: '#1e293b',
      title_color: '#0f172a',
      control_bg_color: '#e2e8f0'
    };

    const darkTheme = {
      background_color: '#1e293b',
      sphere_work_color: '#ef4444',
      sphere_rest_color: '#3b82f6',
      text_color: '#ffffff',
      title_color: '#f8fafc',
      control_bg_color: '#334155'
    };

    let config = { ...defaultConfig };
    let isDarkTheme = true;

    let WORK_TIME = 40;
    let REST_TIME = 20;

    let timeLeft = WORK_TIME;
    let isWorkPhase = true;
    let isRunning = false;
    let intervalId = null;
    let wakeLock = null;

    // FunÃ§Ã£o para manter a tela ativa
    async function requestWakeLock() {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeLock.addEventListener('release', () => {
            console.log('Wake Lock liberado');
          });
        }
      } catch (err) {
        console.error('Erro ao solicitar Wake Lock:', err);
      }
    }

    // FunÃ§Ã£o para liberar o Wake Lock
    async function releaseWakeLock() {
      if (wakeLock !== null) {
        try {
          await wakeLock.release();
          wakeLock = null;
        } catch (err) {
          console.error('Erro ao liberar Wake Lock:', err);
        }
      }
    }

    const timerDisplay = document.getElementById('timer');
    const phaseLabel = document.getElementById('phase');
    const sphere = document.getElementById('sphere');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const titleElement = document.getElementById('title');
    const workTimeDisplay = document.getElementById('workTimeDisplay');
    const restTimeDisplay = document.getElementById('restTimeDisplay');
    const workLabel = document.getElementById('workLabel');
    const restLabel = document.getElementById('restLabel');
    const themeToggle = document.getElementById('themeToggle');

    // FunÃ§Ã£o para falar texto usando sÃ­ntese de voz
    function speak(text) {
      try {
        if ('speechSynthesis' in window) {
          // Cancela qualquer fala anterior
          window.speechSynthesis.cancel();
          
          // Aguarda um momento para garantir que o cancelamento foi processado
          setTimeout(() => {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-BR';
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Para iOS, Ã© importante carregar as vozes primeiro
            let voices = window.speechSynthesis.getVoices();
            if (voices.length === 0) {
              window.speechSynthesis.addEventListener('voiceschanged', function() {
                voices = window.speechSynthesis.getVoices();
                const ptVoice = voices.find(voice => voice.lang.includes('pt-BR') || voice.lang.includes('pt'));
                if (ptVoice) {
                  utterance.voice = ptVoice;
                }
                window.speechSynthesis.speak(utterance);
              }, { once: true });
            } else {
              const ptVoice = voices.find(voice => voice.lang.includes('pt-BR') || voice.lang.includes('pt'));
              if (ptVoice) {
                utterance.voice = ptVoice;
              }
              window.speechSynthesis.speak(utterance);
            }
          }, 100);
        }
      } catch (error) {
        console.error('Erro ao reproduzir voz:', error);
      }
    }

    function updateTimeDisplays() {
      workTimeDisplay.textContent = WORK_TIME + 's';
      restTimeDisplay.textContent = REST_TIME + 's';
    }

    function updateDisplay() {
      timerDisplay.textContent = timeLeft;
      phaseLabel.textContent = isWorkPhase ? (config.work_label || defaultConfig.work_label) : (config.rest_label || defaultConfig.rest_label);
      
      const sphereColor = isWorkPhase ? 
        (config.sphere_work_color || defaultConfig.sphere_work_color) : 
        (config.sphere_rest_color || defaultConfig.sphere_rest_color);
      
      sphere.style.background = sphereColor;
      
      if (isRunning) {
        sphere.classList.add('rotating');
      } else {
        sphere.classList.remove('rotating');
      }
    }

    function tick() {
      timeLeft--;
      
      if (timeLeft <= 0) {
        isWorkPhase = !isWorkPhase;
        timeLeft = isWorkPhase ? WORK_TIME : REST_TIME;
        
        // Fala "TREINAR" ou "DESCANSAR" dependendo da fase
        if (isWorkPhase) {
          speak('TREINAR');
        } else {
          speak('DESCANSAR');
        }
      }
      
      updateDisplay();
    }

    function start() {
      if (!isRunning) {
        isRunning = true;
        requestWakeLock();
        intervalId = setInterval(tick, 1000);
        startBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        updateDisplay();
      }
    }

    function pause() {
      if (isRunning) {
        isRunning = false;
        releaseWakeLock();
        clearInterval(intervalId);
        startBtn.style.display = 'inline-block';
        pauseBtn.style.display = 'none';
        updateDisplay();
      }
    }

    function reset() {
      isRunning = false;
      releaseWakeLock();
      clearInterval(intervalId);
      isWorkPhase = true;
      timeLeft = WORK_TIME;
      startBtn.style.display = 'inline-block';
      pauseBtn.style.display = 'none';
      updateDisplay();
    }

    // Controles de tempo
    document.getElementById('increaseWork').addEventListener('click', () => {
      if (!isRunning) {
        WORK_TIME += 5;
        if (WORK_TIME > 300) WORK_TIME = 300; // mÃ¡ximo 5 minutos
        if (isWorkPhase) timeLeft = WORK_TIME;
        updateTimeDisplays();
        updateDisplay();
      }
    });

    document.getElementById('decreaseWork').addEventListener('click', () => {
      if (!isRunning) {
        WORK_TIME -= 5;
        if (WORK_TIME < 5) WORK_TIME = 5; // mÃ­nimo 5 segundos
        if (isWorkPhase) timeLeft = WORK_TIME;
        updateTimeDisplays();
        updateDisplay();
      }
    });

    document.getElementById('increaseRest').addEventListener('click', () => {
      if (!isRunning) {
        REST_TIME += 5;
        if (REST_TIME > 180) REST_TIME = 180; // mÃ¡ximo 3 minutos
        if (!isWorkPhase) timeLeft = REST_TIME;
        updateTimeDisplays();
        updateDisplay();
      }
    });

    document.getElementById('decreaseRest').addEventListener('click', () => {
      if (!isRunning) {
        REST_TIME -= 5;
        if (REST_TIME < 5) REST_TIME = 5; // mÃ­nimo 5 segundos
        if (!isWorkPhase) timeLeft = REST_TIME;
        updateTimeDisplays();
        updateDisplay();
      }
    });

    // FunÃ§Ã£o para alternar tema
    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      const theme = isDarkTheme ? darkTheme : lightTheme;
      
      // Atualiza o Ã­cone do botÃ£o
      themeToggle.textContent = isDarkTheme ? 'ðŸŒ™' : 'â˜€ï¸';
      themeToggle.style.background = isDarkTheme ? '#fbbf24' : '#475569';
      themeToggle.style.color = isDarkTheme ? '#1e293b' : '#fbbf24';
      
      // Aplica o tema atravÃ©s do SDK se disponÃ­vel
      if (window.elementSdk) {
        window.elementSdk.setConfig({
          background_color: theme.background_color,
          text_color: theme.text_color,
          title_color: theme.title_color,
          control_bg_color: theme.control_bg_color
        });
      } else {
        // Aplica diretamente se o SDK nÃ£o estiver disponÃ­vel
        config.background_color = theme.background_color;
        config.text_color = theme.text_color;
        config.title_color = theme.title_color;
        config.control_bg_color = theme.control_bg_color;
        onConfigChange(config);
      }
    }

    themeToggle.addEventListener('click', toggleTheme);
    startBtn.addEventListener('click', start);
    pauseBtn.addEventListener('click', pause);
    resetBtn.addEventListener('click', reset);

    async function onConfigChange(newConfig) {
      const customFont = newConfig.font_family || defaultConfig.font_family;
      const baseFontStack = '-apple-system, BlinkMacSystemFont, sans-serif';
      const baseSize = newConfig.font_size || defaultConfig.font_size;

      document.body.style.background = newConfig.background_color || defaultConfig.background_color;
      
      titleElement.textContent = newConfig.title_text || defaultConfig.title_text;
      titleElement.style.color = newConfig.title_color || defaultConfig.title_color;
      titleElement.style.fontFamily = `${customFont}, ${baseFontStack}`;
      titleElement.style.fontSize = `${baseSize * 2.5}px`;

      timerDisplay.style.color = newConfig.text_color || defaultConfig.text_color;
      timerDisplay.style.fontFamily = `${customFont}, ${baseFontStack}`;
      timerDisplay.style.fontSize = `${baseSize * 4}px`;

      phaseLabel.style.color = newConfig.text_color || defaultConfig.text_color;
      phaseLabel.style.fontFamily = `${customFont}, ${baseFontStack}`;
      phaseLabel.style.fontSize = `${baseSize * 1.5}px`;

      workLabel.textContent = newConfig.work_label || defaultConfig.work_label;
      workLabel.style.color = newConfig.title_color || defaultConfig.title_color;
      workLabel.style.fontFamily = `${customFont}, ${baseFontStack}`;
      workLabel.style.fontSize = `${baseSize * 0.875}px`;

      restLabel.textContent = newConfig.rest_label || defaultConfig.rest_label;
      restLabel.style.color = newConfig.title_color || defaultConfig.title_color;
      restLabel.style.fontFamily = `${customFont}, ${baseFontStack}`;
      restLabel.style.fontSize = `${baseSize * 0.875}px`;

      const controlBg = newConfig.control_bg_color || defaultConfig.control_bg_color;
      workTimeDisplay.style.background = controlBg;
      workTimeDisplay.style.color = newConfig.text_color || defaultConfig.text_color;
      workTimeDisplay.style.fontFamily = `${customFont}, ${baseFontStack}`;
      workTimeDisplay.style.fontSize = `${baseSize * 1.5}px`;

      restTimeDisplay.style.background = controlBg;
      restTimeDisplay.style.color = newConfig.text_color || defaultConfig.text_color;
      restTimeDisplay.style.fontFamily = `${customFont}, ${baseFontStack}`;
      restTimeDisplay.style.fontSize = `${baseSize * 1.5}px`;

      const timeButtons = document.querySelectorAll('.time-btn');
      timeButtons.forEach(btn => {
        btn.style.background = newConfig.sphere_work_color || defaultConfig.sphere_work_color;
        btn.style.color = '#ffffff';
      });

      updateDisplay();
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => {
              cfg.background_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => cfg.sphere_work_color || defaultConfig.sphere_work_color,
            set: (value) => {
              cfg.sphere_work_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ sphere_work_color: value });
              }
            }
          },
          {
            get: () => cfg.sphere_rest_color || defaultConfig.sphere_rest_color,
            set: (value) => {
              cfg.sphere_rest_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ sphere_rest_color: value });
              }
            }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => {
              cfg.text_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => cfg.title_color || defaultConfig.title_color,
            set: (value) => {
              cfg.title_color = value;
              if (window.elementSdk) {
                window.elementSdk.setConfig({ title_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => cfg.font_family || defaultConfig.font_family,
          set: (value) => {
            cfg.font_family = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => cfg.font_size || defaultConfig.font_size,
          set: (value) => {
            cfg.font_size = value;
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['title_text', cfg.title_text || defaultConfig.title_text],
        ['work_label', cfg.work_label || defaultConfig.work_label],
        ['rest_label', cfg.rest_label || defaultConfig.rest_label]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });

      config = window.elementSdk.config;
    }

    // Aplica o estilo inicial do botÃ£o de tema
    themeToggle.style.background = '#fbbf24';
    themeToggle.style.color = '#1e293b';

    updateTimeDisplays();
    updateDisplay();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a7e87ab76bb6f85',t:'MTc2NDcxNzM2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>